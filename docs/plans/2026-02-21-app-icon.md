# App-Icon Implementierungsplan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Ein macOS-App-Icon (.icns) für den Mandelbrot Explorer, das einen echten Mandelbrot-Render zeigt.

**Architecture:** Ein Python-Skript rendert eine 512×512 PNG mit dem Mandelbrot-Set (pure stdlib: zlib, struct). `sips` erzeugt alle Icon-Größen, `iconutil` kompiliert das `.icns`. Das `.icns` kommt ins App-Bundle, `Info.plist` erhält `CFBundleIconFile`.

**Tech Stack:** Python 3 (stdlib), sips, iconutil, macOS App-Bundle

---

## Task 1: Python-Skript `make_icon.py` anlegen und ausführen

**Files:**
- Create: `make_icon.py`

**Schritt 1: `make_icon.py` schreiben**

```python
#!/usr/bin/env python3
"""Mandelbrot Explorer – App-Icon Generator (pure stdlib)"""
import struct, zlib, math, os

SIZE     = 512
MAX_ITER = 256
CX       = -0.75
CY       =  0.0
SCALE    =  1.35   # Einheiten pro Hälfte (zeigt ganze Menge)
RADIUS   = int(SIZE * 0.175)   # abgerundete Ecken
BG       = (0x1a, 0x1a, 0x2e, 255)

def mandelbrot(cx, cy):
    zx = zy = 0.0
    for i in range(MAX_ITER):
        zx2, zy2 = zx*zx, zy*zy
        if zx2 + zy2 > 256.0:
            log_zn = math.log(zx2 + zy2) * 0.5
            nu     = math.log(log_zn / math.log(2)) / math.log(2)
            return (i + 1 - nu) / MAX_ITER
        zy = 2*zx*zy + cy
        zx = zx2 - zy2 + cx
    return -1.0

def hsv2rgb(h, s, v):
    h = h % 1.0
    i = int(h * 6)
    f = h * 6 - i
    p, q, t = v*(1-s), v*(1-f*s), v*(1-(1-f)*s)
    r, g, b = [(v,t,p),(q,v,p),(p,v,t),(p,q,v),(t,p,v),(v,p,q)][i % 6]
    return int(r*255), int(g*255), int(b*255)

def colorize(t):
    return hsv2rgb((t * 3.0 + 0.6) % 1.0, 0.85, math.sqrt(t))

def in_rounded_rect(px, py):
    cx2, cy2 = SIZE / 2.0, SIZE / 2.0
    dx = max(abs(px - cx2) - (cx2 - RADIUS), 0)
    dy = max(abs(py - cy2) - (cy2 - RADIUS), 0)
    return dx*dx + dy*dy <= RADIUS*RADIUS

def write_png(path, rows):
    def chunk(name, data):
        c = name + data
        return struct.pack('>I', len(data)) + c + struct.pack('>I', zlib.crc32(c) & 0xffffffff)
    ihdr = struct.pack('>IIBBBBB', SIZE, SIZE, 8, 6, 0, 0, 0)  # RGBA
    raw  = bytearray()
    for row in rows:
        raw.append(0)   # Filter None
        raw.extend(row)
    with open(path, 'wb') as f:
        f.write(b'\x89PNG\r\n\x1a\n')
        f.write(chunk(b'IHDR', ihdr))
        f.write(chunk(b'IDAT', zlib.compress(bytes(raw), 6)))
        f.write(chunk(b'IEND', b''))

def main():
    print(f'Rendere {SIZE}×{SIZE} Mandelbrot-Icon …')
    rows = []
    for py in range(SIZE):
        row = bytearray()
        cy_val = CY - (py / SIZE - 0.5) * 2.0 * SCALE   # Y-Achse invertieren
        for px in range(SIZE):
            cx_val = CX + (px / SIZE - 0.5) * 2.0 * SCALE
            if not in_rounded_rect(px + 0.5, py + 0.5):
                row.extend([0, 0, 0, 0])   # transparent (Ecken)
                continue
            t = mandelbrot(cx_val, cy_val)
            if t < 0:
                row.extend(BG)
            else:
                r, g, b = colorize(t)
                row.extend([r, g, b, 255])
        rows.append(row)
        if py % 64 == 0:
            print(f'  {py}/{SIZE}')
    write_png('icon_base.png', rows)
    print('✓ icon_base.png geschrieben')

if __name__ == '__main__':
    main()
```

**Schritt 2: Skript ausführen**

```bash
cd /Users/jjr/mandelbrot
python3 make_icon.py
```

Erwartung: Ausgabe `✓ icon_base.png geschrieben` (dauert ~15–30 Sekunden).

**Schritt 3: PNG visuell prüfen**

```bash
open icon_base.png
```

Erwartung: Mandelbrot-Menge auf dunklem Blau-Hintergrund, abgerundete Ecken, farbiger Rand.

**Schritt 4: Commit**

```bash
git add make_icon.py
git commit -m "feat: Icon-Generator-Skript (Mandelbrot PNG)"
```

---

## Task 2: Iconset und .icns erzeugen

**Files:**
- Create: `AppIcon.iconset/` (Verzeichnis mit PNG-Varianten)
- Create: `MandelbrotExplorer.app/Contents/Resources/AppIcon.icns`

**Schritt 1: Iconset-Verzeichnis anlegen**

```bash
mkdir -p /Users/jjr/mandelbrot/AppIcon.iconset
```

**Schritt 2: Alle Größen mit sips erzeugen**

```bash
cd /Users/jjr/mandelbrot
sips -z 16   16   icon_base.png --out AppIcon.iconset/icon_16x16.png
sips -z 32   32   icon_base.png --out AppIcon.iconset/icon_16x16@2x.png
sips -z 32   32   icon_base.png --out AppIcon.iconset/icon_32x32.png
sips -z 64   64   icon_base.png --out AppIcon.iconset/icon_32x32@2x.png
sips -z 128  128  icon_base.png --out AppIcon.iconset/icon_128x128.png
sips -z 256  256  icon_base.png --out AppIcon.iconset/icon_128x128@2x.png
sips -z 256  256  icon_base.png --out AppIcon.iconset/icon_256x256.png
sips -z 512  512  icon_base.png --out AppIcon.iconset/icon_256x256@2x.png
sips -z 512  512  icon_base.png --out AppIcon.iconset/icon_512x512.png
sips -z 512  512  icon_base.png --out AppIcon.iconset/icon_512x512@2x.png
```

**Schritt 3: .icns mit iconutil kompilieren**

```bash
iconutil -c icns AppIcon.iconset -o MandelbrotExplorer.app/Contents/Resources/AppIcon.icns
```

Erwartung: Datei `MandelbrotExplorer.app/Contents/Resources/AppIcon.icns` existiert.

```bash
ls -lh MandelbrotExplorer.app/Contents/Resources/AppIcon.icns
```

---

## Task 3: Info.plist erweitern und App testen

**Files:**
- Modify: `MandelbrotExplorer.app/Contents/Info.plist`

**Schritt 1: `CFBundleIconFile` in Info.plist eintragen**

Den `<dict>`-Block in `Info.plist` um diesen Eintrag erweitern (vor dem schließenden `</dict>`):

```xml
    <key>CFBundleIconFile</key>
    <string>AppIcon</string>
```

**Schritt 2: App-Bundle aktualisieren (Finder-Cache leeren)**

```bash
touch /Users/jjr/mandelbrot/MandelbrotExplorer.app
```

**Schritt 3: App starten und Dock-Icon prüfen**

```bash
pkill -x MandelbrotExplorer 2>/dev/null; sleep 0.3
open /Users/jjr/mandelbrot/MandelbrotExplorer.app
```

Erwartung: Im Dock erscheint das Mandelbrot-Icon (abgerundete Ecken, farbiger Fraktal).

**Schritt 4: Finaler Commit**

```bash
git add MandelbrotExplorer.app/Contents/Resources/AppIcon.icns \
        MandelbrotExplorer.app/Contents/Info.plist
git commit -m "feat: macOS App-Icon mit Mandelbrot-Render"
git push
```
